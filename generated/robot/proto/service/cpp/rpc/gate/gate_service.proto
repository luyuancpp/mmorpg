syntax = "proto3";
option go_package = "robot/service/cpp/rpc/gate;gate";

import "proto/service/go/grpc/db/proto_option.proto";
import "proto/common/empty.proto";
import "proto/common/message.proto";

option cc_generic_services = true;
option (OptionFileDefaultNode) = NODE_GATE;


// Centre -> Gate: 请求踢掉某个 session（带期望版本）
message KickSessionRequest {
  uint64 session_id = 1;
  uint64 expected_session_version = 2; // Gate 只有在版本匹配时才断开
}

message BindSessionToGateRequest {
  uint64 session_id = 1;
  uint64 player_id = 2;
  uint64 session_version = 3; 
}

message BroadcastToPlayersRequest
{
  repeated uint64 session_list = 1;
  MessageContent message_content = 2;
}

service Gate {
  rpc PlayerEnterGameNode (RegisterGameNodeSessionRequest) returns (RegisterGameNodeSessionResponse);
  rpc SendMessageToPlayer (NodeRouteMessageRequest) returns (Empty);
  rpc KickSessionByCentre (KickSessionRequest) returns (Empty);
  rpc RouteNodeMessage (RouteMessageRequest) returns (RouteMessageResponse);
  rpc RoutePlayerMessage (RoutePlayerMessageRequest) returns (RoutePlayerMessageResponse);
  rpc BroadcastToPlayers (BroadcastToPlayersRequest) returns (Empty);
  rpc NodeHandshake(NodeHandshakeRequest) returns (NodeHandshakeResponse);
  rpc BindSessionToGate(BindSessionToGateRequest) returns (Empty);
  
}
