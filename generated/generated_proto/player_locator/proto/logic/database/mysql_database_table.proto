syntax = "proto3";
option go_package = "player_locator/proto/logic/database;database";

import "proto/service/go/grpc/db/proto_option.proto";
import "proto/common/user_accounts.proto";
import "proto/logic/component/player_scene_comp.proto";
import "proto/logic/component/actor_comp.proto";
import "proto/logic/component/player_comp.proto";
import "proto/logic/component/player_skill_comp.proto";

// ------------------- 用户基础信息表 -------------------
message user
{
  option(OptionTableName) = "user";
  option(OptionPrimaryKey) = "id";
  option(OptionIndex) = "last_login";  // 对应 SQL INDEX(last_login)

  uint64 id = 1;                 // 全局唯一用户ID
  string display_name = 2;       // 昵称，可为空
  bool is_guest = 3;             // 是否游客
  uint64 create_time = 4;        // 创建时间（时间戳）
  uint64 last_login = 5;         // 上次登录时间（时间戳）
}

// ------------------- 第三方绑定表 -------------------
message user_oauth
{
  option(OptionTableName) = "user_oauth";
  option(OptionPrimaryKey) = "user_id,provider";           // PK = user_id + provider
  option(OptionUniqueKey) = "provider,provider_id";       // UNIQUE(provider, provider_id)

  uint64 user_id = 1;           // 外键 -> user.id
  string provider = 2;          // weixin/google/apple/qq
  string provider_id = 3;       // openid/sub
  uint64 create_time = 4;       // 创建时间
}

// ------------------- 手机号绑定表 -------------------
message user_phone
{
  option(OptionTableName) = "user_phone";
  option(OptionPrimaryKey) = "user_id";                   // 每个用户一条记录
  option(OptionUniqueKey) = "phone";                      // UNIQUE(phone)

  uint64 user_id = 1;           // 外键 -> user.id
  string phone = 2;             // 手机号
  uint64 create_time = 3;       // 创建时间
}

// ------------------- 密码表 -------------------
message user_password
{
  option(OptionTableName) = "user_password";
  option(OptionPrimaryKey) = "user_id";                   // 每个用户一条记录

  uint64 user_id = 1;           // 外键 -> user.id
  string hash = 2;              // 密码哈希
  uint64 create_time = 3;       // 创建时间
}

message user_accounts
{
  option(OptionTableName) = "user_accounts";
  option(OptionPrimaryKey) = "account";
  string account = 1;
  string password = 2;
  AccountSimplePlayerList simple_players = 3;
}

message account_share_database
{
  option(OptionTableName) = "account_share_database";
  option(OptionPrimaryKey) = "account";
  string account = 1;
}

//中心服玩家专用数据
message player_centre_database
{
  option(OptionTableName) = "player_centre_database";
  option(OptionPrimaryKey) = "player_id";
  option(OptionAutoIncrementKey) = "player_id";
  uint64 player_id = 1;
  PlayerSceneContextPBComponent scene_info = 2;
}

//玩家数据库表1,重要数据放这里，不重要数据放另外一个表，(重要:比如金钱，跟收入有关)，登录马上加载
message player_database
{
  option(OptionTableName) = "player_database";
  option(OptionPrimaryKey) = "player_id";
  option(OptionAutoIncrementKey) = "player_id";
  option (OptionIsPlayerDatabase) = true;
  uint64 player_id = 1;
  Transform transform = 2;
  PlayerUint64PBComponent uint64_pb_component = 3;
  PlayerSkillListPBComponent skill_list = 4;
  PlayerUint32PbComponent uint32_pb_component = 5;
  BaseAttributesPbComponent derived_attributes_component = 6;
  LevelPbComponent level_component = 7;
}

message player_database_1
{
  option(OptionTableName) = "player_database_1";
  option(OptionPrimaryKey) = "player_id";
  option(OptionAutoIncrementKey) = "player_id";
  option (OptionIsPlayerDatabase) = true;
  uint64 player_id = 1;
}

