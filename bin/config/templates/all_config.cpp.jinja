#include "all_config.h"

#include <thread>
#include "muduo/base/CountDownLatch.h"

{#- Include config headers #}
{% for item in sheetnames %}
#include "{{ item.lower() }}_config.h"
{% endfor %}

ConfigLoadCallback configLoadCallback;

void LoadConfigs() {
{% for item in sheetnames %}
    {{ item }}ConfigurationTable::Instance().Load();
{% endfor %}

    if (configLoadCallback){
        configLoadCallback();
    }
}

void LoadConfigsAsync() {
    static muduo::CountDownLatch latch({{ sheetnames|length }});
{% for item in sheetnames %}{
        std::thread t([]() {
            {{ item }}ConfigurationTable::Instance().Load();
            latch.countDown();
        });
        t.detach();
    }
{% endfor %}
    latch.wait();

     if (configLoadCallback){
        configLoadCallback();
    }
}

void OnConfigLoadSuccess(const ConfigLoadCallback& callback){
configLoadCallback = callback;
}